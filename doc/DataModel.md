# CodePrimer Data Model
A key aspect of any software development project starts with data modeling; CodePrimer is no exception. 
In CodePrimer, data modeling is done by defining the set of **Business Models** representing the business data model to work with. 

**CodePrimer consumes those Business Models** to generate a set of artifacts to **prime the implementation of a production-grade software solution** using the **architect’s preferred programming language and framework**.

## Business Model
CodePrimer has an opinionated view on data model impacting how you should document yours. As such, a Business Model must have the following characteristics:
- **Id**: A field used to uniquely identify the model instance to deal with. 
  - This field must be one of the following types: **ID** or **UUID**
  - The value is automatically generated by the solution upon creation of a business model instance.
- **Name**: The name used to represent this model in the business world.
- **Description**: A clear description of what this model is used for in the business world.
- **Fields**: A set of fields to capture data that is relevant from the business point of view.
- **Constraints**: A set of rules (e.g. uniqueness restrictions) to enforce consistency of the business model.
- **StateMachine**: The state machine defines the overall logic via a set of business operations and restrictions that must be enforced for this model.
- **Auditable**: Whether changes to a model instance must be auditable from a business point of view.

### Derived Artifacts
The following artifacts can be derived from a Business Model:
- **Entity**: An entity is a subset of a business model meant to be manipulated by the persistence layer (e.g. database)
- **Event**: An event is a subset of a business model meant to be exchanged between the various processing agents of the solution (e.g., worker, scheduled tasks). **An event must only be originated from a trusted component inside of our solution**. It must also **carry a ‘calling context’** to identify the source of the event in order to perform the necessary data validation and auditing imposed by a business process and ensure system integrity.
- **Resource**: A resource is a subset of a business model meant to be exposed and consumed by external systems (e.g. via a REST API)
- **External Resource**: An external resource is residing on an external system and can be consumed by a business process. It typically overlaps with parts of a business model but may also be a subset or a superset of a given business model

### Fields
Fields are *units of data* associated with a `BusinessModel` or one of its artifacts.

A `Field` has the following attributes:
- **name**: Uniquely identify the field in a given `BusinessModel`
- **type**: The type of *business data* associated with this field. The list of supported types is defined below. 
- **description**: Describes the use of this field from a business point of view. This is meant to be included in generated artifacts to give context to developers and end users on how to use/fill this field.
- **default**: The default value to associate with this field, if any. 
  - If not specified, a `null` value will be used as default.
- **example**: Provide sample data that can be contained in this field. This is mainly used by CodePrimer when generating tests and documentation artifacts. 
- **mandatory**: Whether this field is mandatory when creating a new instance of this model. Used to configure business rules and UI artifacts generated by CodePrimer.
  - If not specified, the field is optional.
- **searchable**: Whether this field shoudl be *easily* searchable by end users. CodePrimer uses this value to optimize underlying structures and rules to optimize queries associated with those fields
  - If not specified, no optimization is performed for this field.
- **managed**: Whether the field must be managed by the solution. **A managed field cannot be set or modified by the user** (e.g. timestamps)
  - If not specified, the field is unmanaged.
- **list**: Whether the field is a single item or a list of items.
  - If not specified, the field is a single item
  - When `type` is another `BusinessModel`, this is to identify the relationship type to generate (see below)
- **generated**: Whether this field has been generated/added by CodePrimer for internal use (e.g. DB id)
  - **This is an attribute managed by CodePrimer for its own use**
- **relation**: Whether a relation to another `BusinessModel` class has been found for this field. 
  - Used to facilitate the navigation within a business data model  
  - **This is an attribute managed by CodePrimer for its own use**

### Supported Data Types
Unlike programming languages, CodePrimer *basic data types* are dictated by business meaning, not by storage attributes.
CodePrimer uses `FieldHelper` and TwigExtension classes to map them to programming language data types.

Here is the list of *basic data types* currently supported by CodePrimer. 
- `FieldType::UUID` - **uuid**: Universally unique identifier, version 4 (aka GUID), used as an identifier and set by the solution
- `FieldType::ID` - **id**: Auto-incremented numeric value, used as an identifier and set by the solution
- `FieldType::STRING` - **string**: Short string of characters (e.g. one-line)
- `FieldType::TEXT` - **text**: Long string of characters (e.g. multi-line)
- `FieldType::EMAIL` - **email**: Email address
- `FieldType::URL` - **url**: URL address
- `FieldType::PASSWORD` - **password**: Password field that must be encrypted using a one-way hash algorithm
- `FieldType::PHONE` - **phone**: Phone number stored using [ITU-T E.164](https://en.wikipedia.org/wiki/E.164) format
- `FieldType::DATE` - **date**: Date only stored in `yyyy-mm-dd` format, as entered by the user (i.e. no conversion to UTC performed)
- `FieldType::TIME` - **time**: Time only stored in `hh:mm:ss` 24-hour format, as entered by the user (i.e. no conversion to UTC performed)
- `FieldType::DATETIME` - **datetime**: Date and time **converted to UTC**, sorted using [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601) format
- `FieldType::BOOLEAN` - **boolean**: Boolean value
- `FieldType::INTEGER` - **integer**: Integer value (TODO: specify exact range)
- `FieldType::LONG` - **long**: Long value (TODO: specify exact range)
- `FieldType::FLOAT` - **float**: Float value (TODO: specify exact range)
- `FieldType::DOUBLE` - **double**: Double value (TODO: specify exact range)
- `FieldType::DECIMAL` - **decimal**: Decimal value (TODO: specify exact range)
- `FieldType::PRICE` - **price**: Price of an item (currency + decimal with fixed number of digits based on currency)
- `FieldType::RANDOM_STRING` - **randomstring**: A random string generated by the solution (e.g. activation code)

If you need new ones, feel free to contribute to the project or open an issue to let us know your need.

### Relationships
Business Models can be linked together via their field definitions. The relationships are not part of the `BusinessModel` class per se but are being exposed via a `PackageHelper` class. The rationale is that relationship rules belong to the business domain and should be customizable as such without impact on the model itself.

CodePrimer currently supports the following relationships:
- **One to One**: Uni-directional or bi-directional link between two `BusinessModel` classes
  - Setup when a field has a type that can be mapped to another `BusinessModel` class in the same package
  - If a similar field pointing back to the `BusinessModel` is found in the opposite class, a bi-directional relationship is created on both sides
  - Otherwise, a uni-directional relationship is created on the originating class 
  - Referred as `Relationship::ONE_TO_ONE` in the code  
- **One to Many**: Uni-directional or bi-directional link between two `BusinessModel` classes
  - Setup when a field has a type that can be mapped to a list of another `BusinessModel` class in the same package
  - If a similar field pointing back to a single `BusinessModel` is found in the opposite class, a bi-directional relationship is created on both sides
  - Otherwise, a uni-directional relationship is created on the originating class 
  - Referred as `Relationship::ONE_TO_MANY` in the code  
- **Many to Many**: Bi-directional link between two `BusinessModel` classes
  - Setup when a field has a type that can be mapped to a list of another `BusinessModel` class in the same package and a similar field pointing back to a list of `BusinessModel` is found in the opposite class
  - Referred as `Relationship::MANY_TO_MANY` in the code  

## Business Package
In CodePrimer, a **Business Package** is a **collection of Business Models and Business Processes** that are related together defining the boundaries of a business component. As such, it is a good entry point to retrieve the list of elements to include when generating a given artifact (e.g. entities).
